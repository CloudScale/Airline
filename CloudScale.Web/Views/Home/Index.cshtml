@{
    ViewBag.Title = "Home Page";


    var webHost = Microsoft.WindowsAzure.CloudConfigurationManager.GetSetting("WebHost");
    var apiHost = Microsoft.WindowsAzure.CloudConfigurationManager.GetSetting("ApiHost");
    var signalrHost = Microsoft.WindowsAzure.CloudConfigurationManager.GetSetting("SignalRHost");
}

@section scripts
{
    <script src="@signalrHost/scripts/jquery.signalR-2.1.1.min.js"></script>
    <script src="@signalrHost/signalr/hubs"></script>
    <script src="~/ViewModels/MainViewModel.js"></script>
    <script type="text/javascript">
        (function () {
            var viewModel = new CloudScale.MainViewModel('@apiHost', '20581a70-11bf-433c-9a7f-3198e1501757');

            ko.applyBindings(viewModel);

            PNotify.prototype.options.styling = "bootstrap3";
            
            viewModel.GetRandomMovie();

            // set up SignalR
            $.connection.hub.url = "@signalrHost/signalr";

            var hub = $.connection.movieHub;

            hub.client.Ping = function () {
                new PNotify({
                    text: 'ping... pong...',
                    nonblock: {
                        nonblock: true,
                        nonblock_opacity: .2
                    }
                });
            }

            hub.client.Notify = function (message) {
                new PNotify({
                    text: message,
                    nonblock: {
                        nonblock: true,
                        nonblock_opacity: .2
                    },
                    history: {
                        maxonscreen: 5
                    }
                });
            }

            $.connection.hub.logging = false;
            $.connection.hub.start().done(function () {
                // do stuff ?  register session id?
            });
        })();
    </script>
}

    <h1>Movies</h1>
    <div class="row">
        <div class="col-lg-4">
            <div class="form-group">
                <label>Search Movies</label>
                <input type="text" data-bind="enable: IsAuth, value: SearchString, valueUpdate: 'afterkeydown'" />
                <input class="btn btn-primary" type="button" data-bind="enable: SearchString, click: SearchMovie" value="Search" />
            </div>

            <div class="form-group">
                <label>Add Movie</label>
                <input type="text" data-bind="enable: IsAuth, value: AddString, valueUpdate: 'afterkeydown'" />
                <input class="btn btn-primary" type="button" data-bind="enable: AddString, click: AddMovie" value="Add" />
            </div>

            <div class="form-group">
                <input class="btn btn-primary" type="button" data-bind="enable: IsAuth, click: GetRandomMovie" value="Get Movie" />
            </div>
        </div>

        <div class="col-lg-8 panel panel-body" data-bind="visible: !IsAuth()">
            <h1>Please log in to access this site</h1>
        </div>

        <div class="col-lg-8" data-bind="visible: IsAuth">
            <div data-bind="with: CurrentMovie">
                <h3 data-bind="text: Name"></h3>
                <img data-bind="attr:{src: Poster}" />
                <h4 data-bind="visible: Rating">Your Rating: <span data-bind="text: Rating"></span></h4>
            </div>

            <p>

            </p>

            <div class="btn-toolbar text-center">
                <div class=" btn-group">
                    <button type="button" class="btn btn-default" data-bind="click: GetRandomMovie">X</button>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-default" data-bind="click: Vote">1</button>
                    <button type="button" class="btn btn-default" data-bind="click: Vote">2</button>
                    <button type="button" class="btn btn-default" data-bind="click: Vote">3</button>
                    <button type="button" class="btn btn-default" data-bind="click: Vote">4</button>
                    <button type="button" class="btn btn-default" data-bind="click: Vote">5</button>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-12" data-bind="visible: Movies">
        <div class="row" data-bind="foreach: Movies">
            <h3 data-bind="text: Name" />
        </div>
    </div>
